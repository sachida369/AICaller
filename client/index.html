<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Agent Caller</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
</head>
<body class="bg-gray-50 text-gray-800">
  <nav class="bg-white shadow-md sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
      <div class="text-2xl font-bold text-indigo-600">YourAI Dialer</div>
      <div class="space-x-4">
        <a href="#" class="text-gray-700 hover:text-indigo-600">Docs</a>
        <a href="#" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition">Login</a>
      </div>
    </div>
  </nav>

  <main class="max-w-6xl mx-auto px-6 py-8">
    <section class="bg-white rounded-2xl shadow p-6">
      <h1 class="text-3xl font-semibold">Upload Leads & Launch</h1>
      <p class="text-gray-600 mt-2">Upload a CSV, create a campaign, and click <strong>Start</strong>. The server will call each lead (or simulate if Twilio is not configured).</p>

      <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="col-span-1 p-4 rounded-xl border">
          <h2 class="font-medium">1) Upload CSV</h2>
          <input id="csv" type="file" accept=".csv" class="mt-3 block w-full" />
          <button id="btnUpload" class="mt-3 bg-indigo-600 text-white px-4 py-2 rounded-lg">Upload</button>
          <div id="uploadMsg" class="text-sm text-gray-600 mt-2"></div>
        </div>

        <div class="col-span-1 p-4 rounded-xl border">
          <h2 class="font-medium">2) Create Campaign</h2>
          <label class="block text-sm mt-2">Name</label>
          <input id="campName" class="border rounded w-full p-2" placeholder="August Outbound" />
          <label class="block text-sm mt-3">Max Concurrent Calls</label>
          <input id="campConc" type="number" min="1" value="3" class="border rounded w-full p-2" />
          <label class="block text-sm mt-3">Script (opening line)</label>
          <textarea id="campScript" class="border rounded w-full p-2" rows="4">Hi, this is our AI assistant...</textarea>
          <button id="btnCreate" class="mt-3 bg-indigo-600 text-white px-4 py-2 rounded-lg">Create</button>
          <div id="campMsg" class="text-sm text-gray-600 mt-2"></div>
        </div>

        <div class="col-span-1 p-4 rounded-xl border">
          <h2 class="font-medium">3) Start</h2>
          <input id="campId" class="border rounded w-full p-2" placeholder="Campaign ID" />
          <button id="btnStart" class="mt-3 bg-green-600 text-white px-4 py-2 rounded-lg">Start Campaign</button>
          <div id="startMsg" class="text-sm text-gray-600 mt-2"></div>
        </div>
      </div>
    </section>

    <section class="mt-8 bg-white rounded-2xl shadow p-6">
      <h2 class="text-2xl font-semibold flex items-center gap-2"><i data-feather="bar-chart-2"></i> Live Status</h2>
      <div class="mt-4">
        <label class="text-sm">Campaign ID</label>
        <input id="statusCampId" class="border rounded p-2 w-64" placeholder="paste campaign id" />
        <button id="btnStatus" class="ml-2 bg-gray-800 text-white px-4 py-2 rounded-lg">Refresh</button>
      </div>
      <pre id="statusOut" class="mt-4 bg-gray-100 p-4 rounded overflow-auto h-64"></pre>
    </section>
  </main>

  <footer class="text-center text-gray-500 py-8">&copy; 2025 YourAI. All rights reserved.</footer>

  <script>
    feather.replace();

    const uploadBtn = document.getElementById('btnUpload');
    const createBtn = document.getElementById('btnCreate');
    const startBtn = document.getElementById('btnStart');
    const statusBtn = document.getElementById('btnStatus');

    uploadBtn.onclick = async () => {
      const file = document.getElementById('csv').files[0];
      if (!file) return alert('Select a CSV first');
      const fd = new FormData();
      fd.append('file', file);
      const res = await fetch('/api/leads/upload', { method: 'POST', body: fd });
      const data = await res.json();
      document.getElementById('uploadMsg').textContent = res.ok ? `Imported ${data.imported} leads` : (data.error || 'Upload failed');
    };

    createBtn.onclick = async () => {
      const name = document.getElementById('campName').value || 'Campaign';
      const maxConcurrent = parseInt(document.getElementById('campConc').value || '3', 10);
      const script = document.getElementById('campScript').value || '';
      const res = await fetch('/api/campaigns', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, maxConcurrent, script })
      });
      const data = await res.json();
      if (res.ok) {
        document.getElementById('campMsg').textContent = `Created campaign ${data.campaign.name} with id ${data.campaign.id}`;
        document.getElementById('campId').value = data.campaign.id;
        document.getElementById('statusCampId').value = data.campaign.id;
      } else {
        document.getElementById('campMsg').textContent = data.error || 'Create failed';
      }
    };

    startBtn.onclick = async () => {
      const id = document.getElementById('campId').value.trim();
      if (!id) return alert('Enter a campaign id');
      const res = await fetch(`/api/campaigns/${id}/start`, { method: 'POST' });
      const data = await res.json();
      document.getElementById('startMsg').textContent = res.ok ? 'Started!' : (data.error || 'Start failed');
    };

    statusBtn.onclick = async () => {
      const id = document.getElementById('statusCampId').value.trim();
      if (!id) return alert('Enter a campaign id');
      const res = await fetch(`/api/campaigns/${id}`);
      const data = await res.json();
      document.getElementById('statusOut').textContent = JSON.stringify(data, null, 2);
    };
  </script>
</body>
</html>
